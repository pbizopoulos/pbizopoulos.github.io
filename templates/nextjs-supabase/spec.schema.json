{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://jsonschemas.com/pbizopoulos/pbizopoulos.github.io/spec.schema.json",
  "title": "LLM-Actionable BDD Acceptance Criteria Specification",
  "description": "The complete and authoritative source of truth for platform behavior, designed to be used as a direct input prompt for an LLM to generate or update corresponding code.",
  "type": "object",
  "required": [
    "llm_prompt_directives",
    "feature",
    "repository_initialization_command",
    "acceptance_criteria_enforcement_loop",
    "implementation_acceptance_criteria",
    "behavior_acceptance_criteria"
  ],
  "additionalProperties": false,
  "specificationGuidelines": [
    "Complete and authoritative source of truth.",
    "No undocumented behavior, architecture, UX, or technical assumptions.",
    "Only explicitly specified behaviors and failure modes should be implemented.",
    "Observable behavior must exactly satisfy the criteria (technology-agnostic)."
  ],
  "properties": {
    "llm_prompt_directives": {
      "title": "LLM Prompt Directives",
      "description": "The operational context and rules for the LLM implementation agent.",
      "type": "array",
      "items": {
        "type": "string"
      },
      "const": [
        "You are a senior software engineer and BDD expert.",
        "Your task is to implement or update the feature described in this JSON specification.",
        "Treat this JSON as the absolute source of truth; any behavior or technical detail not specified here should not be implemented.",
        "Use the provided repository initialization command to establish the environment if necessary.",
        "Continuously run the acceptance criteria enforcement loop to verify your work.",
        "Prioritize type safety, clean code, and exhaustive test coverage for all specified scenarios.",
        "Ensure the final implementation exactly matches the observable behavior defined in the behavior_acceptance_criteria."
      ]
    },
    "feature": {
      "title": "Feature Name",
      "description": "High-level name of the feature or behavior being specified.",
      "type": "string",
      "minLength": 1,
      "examples": ["User Authentication", "Notes Management"]
    },
    "repository_initialization_command": {
      "title": "Repository Initialization Command",
      "description": "The command used to initialize the repository from a template.",
      "type": "string",
      "const": "nix flake init -t github:pbizopoulos/pbizopoulos.github.io#nextjs-supabase"
    },
    "acceptance_criteria_enforcement_loop": {
      "title": "Acceptance Criteria Enforcement Loop",
      "description": "The command used to continuously run test.sh and fix all errors warnings.",
      "type": "string",
      "const": "./test.sh"
    },
    "implementation_acceptance_criteria": {
      "title": "Implementation Acceptance Criteria",
      "description": "Technical requirements that the implementation must satisfy, including test coverage.",
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string"
      }
    },
    "behavior_acceptance_criteria": {
      "title": "Behavior Acceptance Criteria",
      "description": "A list of authoritative scenarios that define the complete observable behavior.",
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/behavior_scenario"
      }
    }
  },
  "examples": [
    {
      "$schema": "https://jsonschemas.com/pbizopoulos/pbizopoulos.github.io/spec.schema.json",
      "llm_prompt_directives": [
        "You are a senior software engineer and BDD expert.",
        "Your task is to implement or update the feature described in this JSON specification.",
        "Treat this JSON as the absolute source of truth; any behavior or technical detail not specified here should not be implemented.",
        "Use the provided repository initialization command to establish the environment if necessary.",
        "Continuously run the acceptance criteria enforcement loop to verify your work.",
        "Prioritize type safety, clean code, and exhaustive test coverage for all specified scenarios.",
        "Ensure the final implementation exactly matches the observable behavior defined in the behavior_acceptance_criteria."
      ],
      "feature": "Minimal Next.js + Supabase Application Specification",
      "repository_initialization_command": "nix flake init -t github:pbizopoulos/pbizopoulos.github.io#nextjs-supabase",
      "acceptance_criteria_enforcement_loop": "./test.sh",
      "implementation_acceptance_criteria": [
        "The test coverage should be at least 95%.",
        "The application should use Next.js for routing and server-side rendering.",
        "The application should use Supabase for authentication and database management.",
        "The application should use Vitest for unit testing and Playwright for E2E testing.",
        "The application should use Nix for environment reproducibility.",
        "The application should use TypeScript for type safety.",
        "The application should use Vanilla CSS for styling."
      ],
      "behavior_acceptance_criteria": [
        {
          "name": "Omni-Channel Authentication & Profile Creation",
          "given": [
            {
              "type": "given",
              "statement": "I am on the home page"
            },
            {
              "type": "and",
              "statement": "I see the 'Minimal Application' branding"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "I click 'Sign In' and then 'Don't have an account? Sign Up'"
            },
            {
              "type": "and",
              "statement": "I enter my username, email, and password"
            },
            {
              "type": "and",
              "statement": "I click the 'Create Account' button"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "The auth form should close"
            },
            {
              "type": "and",
              "statement": "I should see my username in the user menu"
            }
          ]
        },
        {
          "name": "Secure Identity Management & Session Control",
          "given": [
            {
              "type": "given",
              "statement": "I am on the home page"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "I sign in with my email and password"
            },
            {
              "type": "and",
              "statement": "I open the user menu and click 'Sign Out'"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "I should be signed out"
            },
            {
              "type": "and",
              "statement": "The 'Sign In' button should be visible again"
            }
          ]
        },
        {
          "name": "Public Identity Profile Resolution",
          "given": [
            {
              "type": "given",
              "statement": "A user with username 'johndoe' exists"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "I navigate to the profile page at '/johndoe'"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "I should see the 'johndoe' profile heading"
            },
            {
              "type": "and",
              "statement": "I should see the message 'This is a minimal profile page.'"
            }
          ]
        },
        {
          "name": "Resilient Application Recovery & Error States",
          "given": [
            {
              "type": "given",
              "statement": "I am on the home page"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "I navigate to a non-existent user profile at '/non-existent-user'"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "I should see the 'Page Not Found' heading"
            },
            {
              "type": "and",
              "statement": "I should see a 'Return Home' link"
            }
          ]
        },
        {
          "name": "Secure Username Policy Enforcement",
          "given": [
            {
              "type": "given",
              "statement": "I am on the sign-up form"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "I enter an invalid username (too short, too long, or invalid characters)"
            },
            {
              "type": "and",
              "statement": "I click the 'Create Account' button"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "I should see an error message describing the username requirements"
            }
          ]
        },
        {
          "name": "Responsive Design & Mobile Accessibility",
          "given": [
            {
              "type": "given",
              "statement": "I am on the home page"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "I view the page on a mobile viewport"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "The layout should adapt to the screen size"
            },
            {
              "type": "and",
              "statement": "The branding and navigation should remain accessible"
            }
          ]
        },
        {
          "name": "Application Performance Budget",
          "given": [
            {
              "type": "given",
              "statement": "I am a user navigating the application"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "The page is loaded"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "The page should load within the performance budget"
            }
          ]
        },
        {
          "name": "Global Error Handling",
          "given": [
            {
              "type": "given",
              "statement": "An unexpected application error occurs"
            }
          ],
          "when": [
            {
              "type": "when",
              "statement": "The error page is rendered"
            }
          ],
          "then": [
            {
              "type": "then",
              "statement": "I should see 'Something went wrong!'"
            },
            {
              "type": "and",
              "statement": "I should see a 'Try again' button"
            }
          ]
        }
      ]
    }
  ],
  "$defs": {
    "behavior_scenario": {
      "title": "Behavioral Scenario",
      "description": "A single observable behavior defined by conditions, triggers, and outcomes.",
      "type": "object",
      "required": ["name", "given", "when", "then"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "title": "Scenario Name",
          "description": "Descriptive name of the success or failure scenario.",
          "type": "string",
          "minLength": 1,
          "examples": ["Successful login", "Password mismatch error"]
        },
        "given": {
          "title": "Givens",
          "description": "Initial conditions and preconditions required for the scenario.",
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/clause"
          }
        },
        "when": {
          "title": "Thens",
          "description": "Events and actions that trigger the scenario.",
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/clause"
          }
        },
        "then": {
          "title": "Thens",
          "description": "Expected outcomes and observable changes in system state.",
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/clause"
          }
        }
      }
    },
    "clause": {
      "title": "Behavioral Clause",
      "description": "A single atomic statement forming part of a BDD scenario.",
      "type": "object",
      "required": ["type", "statement"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "title": "Clause Type",
          "description": "The logic role of the clause in the BDD structure.",
          "type": "string",
          "enum": ["given", "and", "but", "when", "then"]
        },
        "statement": {
          "title": "Clause Statement",
          "description": "The descriptive content of the behavior or condition.",
          "type": "string",
          "minLength": 1,
          "examples": ["I am a visitor", "I click 'Publish'"]
        }
      }
    }
  }
}
